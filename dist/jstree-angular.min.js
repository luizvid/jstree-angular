/*
 jsTree-Angular
 (c) 2015 Luiz Fernando Vid <luizvid@gmail.com>
 License: MIT
 */
var jsTree=angular.module("jsTreeAngular",[]);jsTree.factory("jsTreeService",["$log","$rootScope",function(e,t){"use strict";return this.moved_nodes=[],this.selected_node=void 0,this.cbRefreshTree=function(){},this.cbUndoMove=function(){},this.setMovedNodes=function(e){this._alreadyMoved(e.node.id)!==!1?this._updateMove(e):this._newMove(e),t.$broadcast("jsTreeService:moved",this.moved_nodes)},this._updateMove=function(e){var t=this._alreadyMoved(e.node.id);if(e.parent==this.moved_nodes[t].old_parent)return void this.moved_nodes.splice(t,1);var o={id:e.node.id,parent:e.parent,old_parent:this.moved_nodes[t].old_parent,position:e.position};this.moved_nodes[t]=o},this._newMove=function(e){var t={id:e.node.id,parent:e.parent,old_parent:e.old_parent,position:e.position};this.moved_nodes.push(t)},this.getMovedNodes=function(){return this.moved_nodes},this.cleanMovedNodes=function(){this.moved_nodes=[]},this.undoLastMove=function(){this.moved_nodes.unshift()},this.setSelectedNode=function(e){this.selected_node=e,t.$broadcast("jsTreeService:selected",this.selected_node)},this.getSelectedNode=function(e){return this.selected_node=e},this.clearSelectedNode=function(){this.selected_node=void 0},this.refreshTree=function(){this.clearSelectedNode(),this.cleanMovedNodes(),this.cbRefreshTree()},this._refreshTree=function(e){this.cbRefreshTree=e},this.undoMove=function(){this.undoLastMove(),this.cbUndoMove()},this._undoMove=function(e){this.cbUndoMove=e},this._alreadyMoved=function(e){for(var t=this.moved_nodes.length,o=0;t>o;o++)if(this.moved_nodes[o].id==e)return o;return!1},this}]),jsTree.directive("jsTree",["$log","$timeout","jsTreeService",function(e,t,o){"use strict";return{restrict:"EA",scope:{treeModel:"=",treeSearch:"=",treePlugins:"=",treeOptions:"="},link:function(e,n){function d(e){return!("disabled"==e[0].type||"root"==e[0].type)}var i=["dnd","massload","search","sort","types","state","wholerow"];n.jstree({plugins:i,dnd:{copy:!1,is_draggable:d},search:{show_only_matches:!0,show_only_matches_children:!0},types:{"#":{valid_children:["parent","recursive"]},"default":{valid_children:[]},root:{valid_children:["children"]},parent:{valid_children:["children"]},children:{valid_children:[]},recursive:{valid_children:["recursive"]},disabled:{select_node:!1,open_node:!1,close_node:!1,create_node:!1,delete_node:!1,valid_children:[]}},core:{strings:{"Loading ...":"Carregando ..."},themes:{striped:!0,responsive:!0},check_callback:!0,animation:0}}),e.$watch("treeModel",function(e){null!=e&&(n.jstree(!0).settings.core.data=e,o.refreshTree())},!0),n.on("move_node.jstree",function(e,t){t.parent!=t.old_parent&&o.setMovedNodes(t)}),n.on("dblclick.jstree",function(e){if(e.target.parentNode.id){var t={id:e.target.parentNode.id,parent:e.target.parentNode.parentNode.parentNode.id};o.setSelectedNode(t)}});var r=!1;e.$watch("treeSearch",function(e){angular.isUndefined(e)||(r&&t.cancel(r),r=t(function(){n.jstree(!0).search(e)},250))}),o._refreshTree(function(){n.jstree(!0).refresh(!1,!0)}),o._undoMove(function(){})}}}]);